<!doctype html><html lang=ja class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=nnstt1><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.8"><title>PowerDNS - nnstt1 memo</title><link rel=stylesheet href=../assets/stylesheets/main.6e60f8b8.min.css><link rel=stylesheet href=../assets/stylesheets/palette.e6a45f82.min.css><meta name=theme-color content=#009485><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#powerdns class=md-skip> コンテンツにスキップ </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=ヘッダー> <a href=.. title="nnstt1 memo" class="md-header__button md-logo" aria-label="nnstt1 memo" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> nnstt1 memo </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> PowerDNS </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=検索 placeholder=検索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=クリア tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 検索を初期化 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/nnstt1/docs/ title=リポジトリへ class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nnstt1/docs </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=タブ data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Author </a> </li> <li class=md-tabs__item> <a href=../mkdocs/ class="md-tabs__link md-tabs__link--active"> HomeLab </a> </li> <li class=md-tabs__item> <a href=../ansible/ class=md-tabs__link> Ansible </a> </li> <li class=md-tabs__item> <a href=../kubernetes/container-runtime/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../prometheus/prometheus/ class=md-tabs__link> Prometheus </a> </li> <li class=md-tabs__item> <a href=../raspi-ceph/initial-setup/ class=md-tabs__link> Raspi Ceph </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=ナビゲーション data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="nnstt1 memo" class="md-nav__button md-logo" aria-label="nnstt1 memo" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> nnstt1 memo </label> <div class=md-nav__source> <a href=https://github.com/nnstt1/docs/ title=リポジトリへ class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nnstt1/docs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Author </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> HomeLab <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=HomeLab data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> HomeLab </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../mkdocs/ class=md-nav__link> MkDocs </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> PowerDNS <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> PowerDNS </a> <nav class="md-nav md-nav--secondary" aria-label=目次> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目次 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#postgresql class=md-nav__link> PostgreSQL インストール </a> </li> <li class=md-nav__item> <a href=#powerdns_1 class=md-nav__link> PowerDNS インストール </a> </li> <li class=md-nav__item> <a href=#powerdns-admin class=md-nav__link> PowerDNS-Admin </a> <nav class=md-nav aria-label=PowerDNS-Admin> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> コンテナ </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 事前準備 </a> </li> <li class=md-nav__item> <a href=#yarn-nodejs14 class=md-nav__link> yarn + Nodejs14 </a> </li> <li class=md-nav__item> <a href=#checkout class=md-nav__link> checkout </a> </li> <li class=md-nav__item> <a href=#running class=md-nav__link> Running </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../esxi/ class=md-nav__link> ESXi </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ansible data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ansible/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../ansible/tower/ class=md-nav__link> Ansible Tower </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../kubernetes/container-runtime/ class=md-nav__link> コンテナランタイム </a> </li> <li class=md-nav__item> <a href=../kubernetes/maintenance/ class=md-nav__link> Maintenance </a> </li> <li class=md-nav__item> <a href=../kubernetes/krew/ class=md-nav__link> Krew </a> </li> <li class=md-nav__item> <a href=../kubernetes/istio/ class=md-nav__link> Istio </a> </li> <li class=md-nav__item> <a href=../kubernetes/metallb/ class=md-nav__link> MetalLB </a> </li> <li class=md-nav__item> <a href=../kubernetes/velero/ class=md-nav__link> Velero </a> </li> <li class=md-nav__item> <a href=../kubernetes/rook/ class=md-nav__link> Rook </a> </li> <li class=md-nav__item> <a href=../kubernetes/zalando-postgres-operator/ class=md-nav__link> Zalando Postgres Operator </a> </li> <li class=md-nav__item> <a href=../kubernetes/minio-operator/ class=md-nav__link> MinIO Operator </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Prometheus <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Prometheus data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Prometheus </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../prometheus/prometheus/ class=md-nav__link> Prometheus </a> </li> <li class=md-nav__item> <a href=../prometheus/snmp-exporter/ class=md-nav__link> SNMP Exporter </a> </li> <li class=md-nav__item> <a href=../prometheus/kube-prometheus/ class=md-nav__link> kube-prometheus </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Raspi Ceph <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Raspi Ceph" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Raspi Ceph </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../raspi-ceph/initial-setup/ class=md-nav__link> ラズパイ初期設定 </a> </li> <li class=md-nav__item> <a href=../raspi-ceph/cephadm/ class=md-nav__link> Ceph クラスタ構築 </a> </li> <li class=md-nav__item> <a href=../raspi-ceph/ceph-grafana/ class=md-nav__link> Ceph-Grafana コンテナ </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目次> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目次 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#postgresql class=md-nav__link> PostgreSQL インストール </a> </li> <li class=md-nav__item> <a href=#powerdns_1 class=md-nav__link> PowerDNS インストール </a> </li> <li class=md-nav__item> <a href=#powerdns-admin class=md-nav__link> PowerDNS-Admin </a> <nav class=md-nav aria-label=PowerDNS-Admin> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> コンテナ </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 事前準備 </a> </li> <li class=md-nav__item> <a href=#yarn-nodejs14 class=md-nav__link> yarn + Nodejs14 </a> </li> <li class=md-nav__item> <a href=#checkout class=md-nav__link> checkout </a> </li> <li class=md-nav__item> <a href=#running class=md-nav__link> Running </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/nnstt1/docs/edit/master/docs/powerdns.md title=編集 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=powerdns>PowerDNS</h1> <p>OSS の PowerDNS を自宅ラボ用 DNS サーバとして構築します。</p> <p>https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_openstack_platform/7/html/dns-as-a-service_guide/install_and_configure_powerdns</p> <h2 id=postgresql>PostgreSQL インストール</h2> <div class=highlight><pre><span></span><code>sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm
sudo dnf module disable postgresql
sudo dnf install -y postgresql13-server

sudo /usr/pgsql-13/bin/postgresql-13-setup initdb
sudo systemctl <span class=nb>enable</span> --now postgresql-13

<span class=c1># postgres ユーザのパスワード設定</span>
sudo passwd postgres
su - postgres
<span class=nv>postgres</span><span class=o>=</span><span class=se>\#</span> ALTER ROLE postgres WITH PASSWORD <span class=s1>&#39;postgres&#39;</span><span class=p>;</span>
<span class=nv>postgres</span><span class=o>=</span><span class=se>\#</span> <span class=se>\\</span>q
<span class=nb>exit</span>

<span class=c1># ログイン方法変更</span>
sudo vim /var/lib/pgsql/13/data/pg_hba.conf
sudo systemctl restart postgresql-13

<span class=c1># postgres ユーザで PowerDNS 用データベース作成</span>
psql -U postgres
<span class=nv>postgres</span><span class=o>=</span><span class=se>\#</span> CREATE ROLE pdns WITH LOGIN PASSWORD <span class=s1>&#39;pdns&#39;</span><span class=p>;</span>
<span class=nv>postgres</span><span class=o>=</span><span class=se>\#</span> CREATE DATABASE pdns OWNER <span class=s1>&#39;pdns&#39;</span><span class=p>;</span>
<span class=nv>postgres</span><span class=o>=</span><span class=se>\#</span> <span class=se>\\</span>q

<span class=c1># PowerDNS 用スキーマ作成</span>
wget https://github.com/PowerDNS/pdns/blob/auth-4.5.1/modules/gpgsqlbackend/schema.pgsql.sql
psql -U pdns -d pdns -a -f schema.pgsql.sql 
</code></pre></div> <h2 id=powerdns_1>PowerDNS インストール</h2> <div class=highlight><pre><span></span><code>sudo dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
sudo dnf install -y pdns pdns-backend-postgresql pdns-tools
</code></pre></div> <p>2021/8/14 時点でインストールされたバージョンは 4.5.1 でした。</p> <div class=highlight><pre><span></span><code><span class=go>=================================================================================================================================</span>
<span class=go> パッケージ                      アーキテクチャー           バージョン                  リポジトリー                      サイズ</span>
<span class=go>=================================================================================================================================</span>
<span class=go>インストール:</span>
<span class=go> pdns                            x86_64                    4.5.1-1.el8                 epel                             3.6 M</span>
<span class=go> pdns-backend-postgresql         x86_64                    4.5.1-1.el8                 epel                             67 k</span>
<span class=go> pdns-tools                      x86_64                    45.1-1.el8                  epel                             2.7 M</span>
<span class=go> ```</span>


<span class=gp>#</span><span class=c1># PowerDNS 設定</span>

<span class=go>```ini</span>
<span class=gp># </span>/etc/pdns/pdns.conf
<span class=go>api=yes</span>
<span class=go>api-key=7fe343a8-c445-ed83-f815-81a369883984</span>
<span class=go>launch=gpgsql</span>
<span class=go>setgid=pdns</span>
<span class=go>setuid=pdns</span>
<span class=go>webserver=yes</span>
<span class=go>webserver-address=0.0.0.0</span>
<span class=go>webserver-allow-from=0.0.0.0/0,::1</span>
<span class=go>gpgsql-host=/run/postgresql</span>
<span class=go>gpgsql-dbname=pdns</span>
<span class=go>gpgsql-user=pdns</span>
<span class=go>gpgsql-password=pdns</span>
</code></pre></div> <h2 id=powerdns-admin>PowerDNS-Admin</h2> <p>PowerDNS 用 WebUI ツール <a href=https://github.com/ngoduykhanh/PowerDNS-Admin>PowerDNS-Admin</a> をデプロイします。</p> <h3 id=_1>コンテナ</h3> <p>コンテナを使って PowerDNS-Admin をデプロイする方法です。</p> <div class=highlight><pre><span></span><code>podman run -d <span class=se>\</span>
    --name pdns_admin <span class=se>\</span>
    --restart always <span class=se>\</span>
    -e <span class=nv>SQLALCHEMY_DATABASE_URI</span><span class=o>=</span><span class=s1>&#39;postgresql://powerdnsadmin:powerdnsadmin@192.168.2.3/powerdnsadmindb&#39;</span> <span class=se>\</span>
    -e <span class=nv>SECRET_KEY</span><span class=o>=</span><span class=s1>&#39;a-very-secret-key&#39;</span> <span class=se>\</span>
    -v pda-data:/data <span class=se>\</span>
    -p <span class=m>9191</span>:80 <span class=se>\</span>
    ngoduykhanh/powerdns-admin:latest
</code></pre></div> <h3 id=_2>事前準備</h3> <p>コンテナを使わずに PowerDNS の Web UI として PowerDNS-Admin をインストールする方法です。</p> <p>以下の Wiki を参照します。</p> <p>https://github.com/ngoduykhanh/PowerDNS-Admin/wiki</p> <div class=highlight><pre><span></span><code>sudo dnf install -y postgresql-libs python3 python3-devel postgresql13-devel git gcc openldap-devel libxml2-devel python3-xmlsec
<span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:/usr/pgsql-13/bin/
pip3 install psycopg2 --user
pip3 install virtualenv --user
</code></pre></div> <p>PostgreSQL に PowerDNS-Admin 用のユーザとデータベースを作成します。</p> <div class=highlight><pre><span></span><code>su - postgres
createuser powerdnsadmin    <span class=c1># postgres ユーザのパスワードを入力</span>
createdb powerdnsadmindb
psql
<span class=nv>postgres</span><span class=o>=</span><span class=se>\#</span> ALTER USER powerdnsadmin WITH ENCRYPTED PASSWORD <span class=s1>&#39;powerdnsadmin&#39;</span><span class=p>;</span>
<span class=nv>postgres</span><span class=o>=</span><span class=se>\#</span> GRANT ALL PRIVILEGES ON DATABASE powerdnsadmindb TO powerdnsadmin<span class=p>;</span>
<span class=nv>postgres</span><span class=o>=</span><span class=se>\#</span> <span class=se>\\</span>q
<span class=nb>exit</span>
</code></pre></div> <p>後述の pip で xmlsec をビルドする際に必要な <code>xmlsec1-devel</code> はデフォルトのリポジトリでは提供されていません。 そこで、サポートされていない追加のコンテンツが新しい <code>CodeReady Linux Builder</code> を有効化します。 <code>CodeReady Linux Builder</code> リポジトリには <code>xmlsec1-devel</code> が提供されています。</p> <p>https://access.redhat.com/ja/articles/5304171</p> <div class=highlight><pre><span></span><code>sudo subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms
sudo yum install -y xmlsec1-devel
</code></pre></div> <h3 id=yarn-nodejs14>yarn + Nodejs14</h3> <p>Wiki に記載されている Nodejs は 10 ですが、バージョンが古いため 14 をインストールします。</p> <div class=highlight><pre><span></span><code>curl -sL https://rpm.nodesource.com/setup_14.x <span class=p>|</span> sudo bash -
sudo curl -sL https://dl.yarnpkg.com/rpm/yarn.repo -o /etc/yum.repos.d/yarn.repo
sudo dnf install -y yarn
</code></pre></div> <h3 id=checkout>checkout</h3> <div class=highlight><pre><span></span><code>sudo git clone https://github.com/ngoduykhanh/PowerDNS-Admin.git /opt/web/powerdns-admin
sudo chmod -R <span class=m>777</span> /opt/web/powerdns-admin
<span class=nb>cd</span> /opt/web/powerdns-admin
virtualenv -p python3 flask
. ./flask/bin/activate
<span class=o>(</span>flask<span class=o>)</span> pip install python-dotenv

<span class=c1># requirements.txt から mysqlclient を削除しておく</span>
<span class=o>(</span>flask<span class=o>)</span> pip install --upgrade pip setuptools wheel
<span class=o>(</span>flask<span class=o>)</span> pip install -r requirements.txt
</code></pre></div> <h3 id=running>Running</h3> <div class=highlight><pre><span></span><code><span class=o>(</span>flask<span class=o>)</span> <span class=nb>export</span> <span class=nv>FLASK_APP</span><span class=o>=</span>powerdnsadmin/__init__.py
<span class=o>(</span>flask<span class=o>)</span> flask db upgrade
</code></pre></div> <p><code>flask db upgrade</code> でエラーが発生したが、このタイミングでコンテナを使う方法があると判明し、中断しました。</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=フッター> <a href=../mkdocs/ class="md-footer__link md-footer__link--prev" aria-label="前: MkDocs" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 前 </span> MkDocs </div> </div> </a> <a href=../esxi/ class="md-footer__link md-footer__link--next" aria-label="次: ESXi" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 次 </span> ESXi </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\u3000\u3001\u3002\uff0c\uff0e]+", "search.placeholder": "\u691c\u7d22", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script> <script src=../assets/javascripts/bundle.960e086b.min.js></script> </body> </html>